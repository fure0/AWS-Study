# KMS
- 암호키(Encryption Key) 생성
- 수많은 AWS Resourdes들과 상호작용
- 암호키를 사용하여 데이터를 암호화 하는 방법이 매우 단순함

## 언제 KMS를 사용해야 하나요?
- 고객 데이터
- DB Password & Credentials
- Secrets
- 등등

## KMS를 사용할 수 있는 AWS 리소스들
- S3
- EBS
- RDS
- EFS
- DynamoDB
- CloudTrail
- Lambda
- 등등

## CMK
- Customer Master Key
- 4KM에 해당하는 데이터 암호화 복호화
- Data Key를 생성, 암호화 복호화 할때 사용되어짐
- Data Key를 가지고 실제 Data를 암호화

## Envelope Encryption - 봉투 암호화
- 데이터 암호화 프로세싱
- ~ 4KB 데이터 압축

### 봉투 암호화 과정
- KMS (CMK) -> GenerateDataKeyAPI -> Data Key -> Data

### 봉투 복호화 과정
- Data Key -> KMS (CMK) -> DecryptAPI -> Decryped Data Key -> Data

### 왜 봉투 암호화 하는가?
- 데이터 전체 암호화 하면 네트워크가 무거우니까
- 데이터 키만 암호화

## 실습 1
- IAM 메뉴
- 그룹 생성
  - 그룹 이름 생성
  - 역할 생성 : AdministratorAcess
- 사용자 생성
  - 사용자 이름
  - 그룹 연동
  - 보안 자격 증명 탭
    - 콘솔 엑세스 활성화 선택
    - 암호 설정
- KMS 메뉴
- 키 생성 선택 (고객관리형 키 자동선택 됨)
  - 지역 영향 받음 (서울 도쿄 따로)
- 키 유형 선택
  - 대칭 : 단일키로 암호화 복호화, AWS유저만 사용가능
  - 비대칭 : AWS 이외의 유저 사용가능
- 키 사용 선택
  - 암호화 및 해독
  - MAC 생성 및 확인
- 고급 옵션
  - 키 구성 요소 원본 : 키를 생성할 때 키 구성 요소의 소스를 나타내는 속성
    - KMS
    - 외부
    - AWS CloudHSM 키 스토어
    - 외부 키 스토어
  - 리전 특성
    - 단일 리전 키 : 이 키를 다른 리전으로 복제 허용 안함
    - 다중 리전 키 : 이 키를 다른 리적으로 복제 허용
- 레이블 추가
  - 별칭 지정
- 키 관리 권한 정의
  - 키 관리자 선택 : 작성한 유저 선택
- 키 시용 권한 정의
- 검토
- 완료

## 실습 2
- S3 버킷에서 파일 업로드
  - 비 암호화 용 파일 업로드
    - 암호화 키 지정 안함
  - 암호화 용 파일 업로드
    - 암호화 키 지정
    - AWS KMS 키 중에서 선택
- IAM 유저 생성 (암호화 권한 그룹에 포함 안시킴)
  - 암호화 그룹에 넣지 않음
  - S3 권한 부여 : AmazonS3FullAccess
- 유저로 로그인 (암호화 권한 없음)
  - 비 암호화 파일 접근 가능 확인
  - 암호화 파일 접근 불가능 확인
- 유저로 로그인 (암호화 권한 있음)
  - 비 암호화 파일 접근 가능 확인
  - 암호화 파일 접근 가능 확인
- *KMS 키 삭제는 스케줄링으로 예약 해야 한다. 7일 ~30일